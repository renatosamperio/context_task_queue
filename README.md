# Context-based Task Queue
A context-based task queue implementation of for creating stand-along processes with an specific purpose while having the ability to communicate withing other processes in their or other context.

Communcication is implemented using ZMQ forward devices in a TCP/IP stack.


* Context definition

  TODO: Describe XML

* Tasked service

  TODO: Describe service properties

* Message passsing

  TODO: Describe message data model

* Managing a context

  TODO: Describe how to start/stop/restart a context

# Tutorial
## Service creation
To create a context service it is required to do the following steps:
1. Add a service directory
2. Provide a ```__init__.py```
3. Generate a ```Service[NAME].py``` stub file
4. Generate a strategy file stub
5. Update configuration ```XML``` file

In this tutorial we are using the ```create_service.py``` command that is contained in the ```Tools``` section. This command allow us to run all steps for generating a context service.

## Service configuration
To call the ```create_service.py``` command is required to include:
* Service configuration location
  * __Service path__ is the absolute root path where context services are located
* Service generation stub variables
  * __Service instance type__ is the type of created service as defined in task 
  service parameters as 'instance' in the configuration file.
  * __Task file name__ is for defining specific operations from task class. It will be imported from created directory and used to instance a 
  task class.
  * __Service class name__ is the name of the autogenerated task class. It should have the logic for   producing a service. It is called by the service and imported by file name.
  * __Task Description__ it is required for logging and identifying task operations.
* Service XML configuration options
  * __Context name__ is the logging context name. It is used in 'TaskLogName' in the configuration file.
  * __Service name__ defines a service name for the identifying service process messages. It is called in process configuration configuration file.
  * __Service endpoint__ states an IP address of server endpoint. It is used in 'FrontEndEndpoint' and 'BackendEndpoint' in the configuration file.
  * __Frontend port__ is used as frontend port for subscriber and back end binding ports. It is used in 'FrontEndEndpoint'
  and 'BackendBind' in the configuration file.
  * __Backend port__ is used as backend port for subscriber and front end binding ports. It is used in 'BackendEndpoint' and 'FrontBind' in the configuration file.
  * __Task ID__ defines a task service ID identifier. It is used as parameter 'id' in 'TaskService' label in the configuration file.
  * __Device action__ is the task device action used for message identification. It is called as parameter 'device_action' of the content configuration of the task service in the configuration file.
  
All described parameters are required when calling ```create_service.py``` command.

## Service example
Create a new context service called __EchoAction__:

    $ python create_service.py     
        --service_path='/abs/unix/path/'
		--task_service='EchoAction' 
		--task_file='task_file_name 
		--task_class='EchoShouting' 
		--task_desc='An echo action is for shouting the time after counting 10s' 
		--context_name='EchoAction' 
		--service_name='echo_action' 
		--server_ip='127.0.0.1' 
		--sub_port='5556' 
		--pub_port='5557' 
		--task_id='ts_100' 
		--device_action='shout'

Execute the context server

    $ python service_context.py Conf/Context-EchoAction.xml 
              ContextProvider|  Creating pool with signal handler
                   EchoAction|Parsing tree  [Context] in file: Conf/Context-EchoAction.xml
                   EchoAction|Creating an context provider
           MultiProcessTasks0|[0] Parsing constructor arguments
           MultiProcessTasks0|Initialising multiprocessing parent class
           MultiProcessTasks0|[0] Creating Backend ZMQ endpoint tcp://127.0.0.1:5556
           MultiProcessTasks0|[0] Preparing type of socket communication from arguments
                   EchoAction|Joining thread 0...
           MultiProcessTasks0|[0] Starting service in thread [21398]
                 ContextGroup|  Calling action in thread [0]
           MultiProcessTasks0|[0] Running IPC communication on backend

    
Call __EchoAction__ service:

    $ python service_context.py Conf/Context-EchoAction.xml 
              ContextProvider|  Creating pool with signal handler

Starting __EchoAction__ service:

    $ python service_context.py --endpoint='tcp://127.0.0.1:5557' --context_file='Conf/Context-EchoAction.xml' --service_name='context' --service_id='context001' --transaction='6FDAHH3WPRVV7FGZCRIN' --action='start'
    + Connecting endpoint [tcp://127.0.0.1:5557] in topic [context]
    + Sending message of [1436] bytes
